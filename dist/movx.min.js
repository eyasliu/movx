(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("mobx")):"function"==typeof define&&define.amd?define(["exports","mobx"],b):(a=a||self,b(a.movx={},a.mobx))})(this,function(a,b){'use strict';function c(a){return null!==a&&"object"==typeof a}function d(a){return Array.isArray(a)||c(a)}function e(a){return d(a)?Array.isArray(a)?a.map(a=>({key:a,val:a})):Object.keys(a).map(b=>({key:b,val:a[b]})):[]}class f{constructor(a){this.defineReactive=a.util.defineReactive,this.mobxMethods=b,this.changeDetector=new a}defineReactiveProperty(a,b){const c=this._getReactivePropertyKey(a,b);this.defineReactive(this.changeDetector,c,null,null,!0)}getReactiveProperty(a,b){const c=this._getReactivePropertyKey(a,b);return this.changeDetector[c]}updateReactiveProperty(a,b,c){const d=this._getReactivePropertyKey(a,b);this.changeDetector[d]=c}removeReactiveProperty(a,b){const c=this._getReactivePropertyKey(a,b);delete this.changeDetector[c]}defineReactionList(a,b){const c=this._getReactionListKey(a),d=b.map(({key:b,get:c})=>{return this.mobxMethods.reaction(()=>c.call(a),c=>{this.updateReactiveProperty(a,b,c)},{fireImmediately:!0})});this.changeDetector[c]=d}removeReactionList(a){const b=this._getReactionListKey(a);this.changeDetector[b].forEach(a=>a()),delete this.changeDetector[b]}_getReactionListKey(a){return a._uid}_getReactivePropertyKey(a,b){return`${a._uid}.${b}`}}const g="__$mobxMapState__",h="__$mobxMapAction__",i=(a,b,c,d)=>{if("undefined"==typeof b)return c;for(d=0,b=b.split?b.split("."):b;a&&d<b.length;)a=a[b[d++]];return a===void 0||d<b.length?c:a},j=(a,b)=>{let c=a;switch(b.split(".").length){case 0:case 1:c=a;break;default:const d=b.substr(0,b.lastIndexOf(".")),e=i(a,d);c=e;}return c},k=(a,b,c,d,e)=>{const f=()=>a.getReactiveProperty(c,d);return"function"==typeof e?{get:f,set:a=>e.call(c,a,b)}:f},l=a=>{let b=[];if(Array.isArray(a.$options.mixins)&&a.$options.mixins.forEach(a=>{a.$mapState&&(b=b.concat(e(a.$mapState)))}),b=b.concat(e(a.$options.$mapState)).concat(e(a.$options[g])),!b.length)return[];const c=a.$store;return b.map(({key:b,val:d})=>{let e=b.replace(/\//g,".").split(".").pop(),f=d,g=null;return"string"==typeof d?(d=d.replace(/\//g,"."),f=()=>i(c,d)):"function"==typeof d?f=()=>d.call(a,c):"object"==typeof d&&("string"==typeof d.get?(d.get=d.get.replace(/\//g,"."),f=()=>i(c,d.get)):"function"==typeof d.get&&(f=()=>d.get.call(a,c)),"string"==typeof d.set?(d.set=d.set.replace(/\//g,"."),g=a=>i(c,d.set).call(j(c,d.set),a,c)):"function"==typeof d.set&&(g=b=>d.set.call(a,b,c))),{key:e,get:f,set:g}})},m=a=>{let b=[];if(Array.isArray(a.$options.mixins)&&a.$options.mixins.forEach(a=>{a.$mapAction&&(b=b.concat(e(a.$mapAction)))}),b=b.concat(e(a.$options.$mapAction)).concat(e(a.$options[h])),!b.length)return[];const c=a.$store;return b.map(({key:b,val:d})=>{let e=b.replace(/\//g,".").split(".").pop(),f=d;return"string"==typeof f?(d=d.replace(/\//g,"."),f=i(c,d).bind(j(c,d))):"function"==typeof f&&(f=d.call(a,c)),{key:e,method:f}})};a.default={install:function(a,b){const c=new f(a);a.mixin({beforeCreate:function(){const a=this,d=a.$options;d.store?a.$store=("function"==typeof d.store?d.store():d.store)||b:d.parent&&d.parent.$store?a.$store=d.parent.$store:b&&(a.$store=b),a.$options.computed&&a.$options.computed[g]&&(a.$options[g]=a.$options.computed[g],delete a.$options.computed[g]),a.$options.computed=l(a).reduce((b,{key:d,set:e})=>(c.defineReactiveProperty(a,d),b[d]=k(c,a.$store,a,d,e),b),a.$options.computed||{}),a.$options.methods&&a.$options.methods[h]&&(a.$options[h]=a.$options.methods[h],delete a.$options.methods[h]),a.$options.methods=m(a).reduce((a,{key:b,method:c})=>(a[b]=c,a),a.$options.methods||{})},created:function(){const a=this;c.defineReactionList(a,l(a))},beforeDestroy:function(){const a=this;c.removeReactionList(a),l(a).forEach(({key:b})=>c.removeReactiveProperty(a,b))}})}},a.mapAction=a=>({[h]:a}),a.mapState=a=>({[g]:a}),Object.defineProperty(a,"__esModule",{value:!0})});
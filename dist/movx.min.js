(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("mobx")):"function"==typeof define&&define.amd?define(["exports","mobx"],b):(a=a||self,b(a.movx={},a.mobx))})(this,function(a,b){'use strict';function c(a){return null!==a&&"object"==typeof a}function d(a){return Array.isArray(a)||c(a)}function e(a){return d(a)?Array.isArray(a)?a.map(a=>({key:a,val:a})):Object.keys(a).map(b=>({key:b,val:a[b]})):[]}const f="__$mobxMapState__",g="__$mobxMapAction__",h=(a,b,c,d)=>{if("undefined"==typeof b)return c;for(d=0,b=b.split?b.split("."):b;a&&d<b.length;)a=a[b[d++]];return a===void 0||d<b.length?c:a},i=(a,b)=>{let c=a;switch(b.split(".").length){case 0:case 1:c=a;break;default:const d=b.substr(0,b.lastIndexOf(".")),e=h(a,d);c=e;}return c},j=(a,b,c,d,e)=>{const f=()=>a.getReactiveProperty(c,d);return"function"==typeof e?{get:f,set:a=>e.call(c,a,b)}:f},k={},l=a=>{let b=a._uid;const c=k[b];if(c)return c;let d=[];Array.isArray(a.$options.mixins)&&a.$options.mixins.forEach(a=>{a.$mapState&&(d=d.concat(e(a.$mapState)))}),d=d.concat(e(a.$options.$mapState)).concat(e(a.$options.$computed)).concat(e(a.$options[f]));const g=a.$store;let j=e(a.$options.computed).map(({key:a,val:b})=>{let c=b,d=null;return"object"==typeof b&&"function"==typeof b.get&&(c=b.get),"object"==typeof b&&"function"==typeof b.set&&(d=b.set),~c.toString().indexOf("$store")?{key:a,get:c,set:d}:null}).filter(a=>a);const l=d.map(({key:b,val:c})=>{let d=b.replace(/\//g,".").split(".").pop(),e=c,f=null;return"string"==typeof c?(c=c.replace(/\//g,"."),e=()=>h(g,c)):"function"==typeof c?e=()=>c.call(a,g):"object"==typeof c&&("string"==typeof c.get?(c.get=c.get.replace(/\//g,"."),e=()=>h(g,c.get)):"function"==typeof c.get&&(e=()=>c.get.call(a,g)),"string"==typeof c.set?(c.set=c.set.replace(/\//g,"."),f=a=>h(g,c.set).call(i(g,c.set),a,g)):"function"==typeof c.set&&(f=b=>c.set.call(a,b,g))),{key:d,get:e,set:f}}),m=[...j,...l];return k[b]=m,m},m=a=>{let b=[];if(Array.isArray(a.$options.mixins)&&a.$options.mixins.forEach(a=>{a.$mapAction&&(b=b.concat(e(a.$mapAction)))}),b=b.concat(e(a.$options.$mapAction)).concat(e(a.$options.$methods)).concat(e(a.$options[g])),!b.length)return[];const c=a.$store;return b.map(({key:b,val:d})=>{let e=b.replace(/\//g,".").split(".").pop(),f=d;return"string"==typeof f?(d=d.replace(/\//g,"."),f=h(c,d).bind(i(c,d))):"function"==typeof f&&(f=d.call(a,c)),{key:e,method:f}})};class n{constructor(a){this.defineReactive=a.util.defineReactive,this.mobxMethods=b,this._vm=new a({data:{$$store:{}}}),this.changeDetector=this._vm.$data.$$store}defineReactiveProperty(a,b){const c=this._getReactivePropertyKey(a,b);this.defineReactive(this.changeDetector,c,null,null,!0)}getReactiveProperty(a,b){const c=this._getReactivePropertyKey(a,b);return this.changeDetector[c]}updateReactiveProperty(a,b,c){const d=this._getReactivePropertyKey(a,b);this.changeDetector[d]=c}removeReactiveProperty(a,b){const c=this._getReactivePropertyKey(a,b);delete this.changeDetector[c]}defineReactionList(a,b){const c=this._getReactionListKey(a),d=b.map(({key:b,get:c})=>{return this.mobxMethods.reaction(()=>c.call(a),c=>{this.updateReactiveProperty(a,b,c)},{fireImmediately:!0})});this.changeDetector[c]=d}defineRenderReaction(a){const b=this.mobxMethods.reaction(()=>{if("function"==typeof a.$options.render)return a._render(a.$createElement)},()=>{a.$forceUpdate()},{fireImmediately:!0}),c=this._getReactionListKey(a);this.changeDetector[c].push(b)}removeReactionList(a){const b=this._getReactionListKey(a);this.changeDetector[b].forEach(a=>a()),delete this.changeDetector[b]}_getReactionListKey(a){return a._uid}_getReactivePropertyKey(a,b){return`${a._uid}.${b}`}}a.default={install:function(a,b){const c=new n(a);a.mixin({beforeCreate:function(){const a=this,d=a.$options;d.store?a.$store=("function"==typeof d.store?d.store():d.store)||b:d.parent&&d.parent.$store?a.$store=d.parent.$store:b&&(a.$store=b),a.$options.computed&&a.$options.computed[f]&&(a.$options[f]=a.$options.computed[f],delete a.$options.computed[f]),a.$options.computed=l(a).reduce((b,{key:d,set:e,get:f})=>(c.defineReactiveProperty(a,d),b[d]=j(c,a.$store,a,d,e),b),a.$options.computed||{}),a.$options.methods&&a.$options.methods[g]&&(a.$options[g]=a.$options.methods[g],delete a.$options.methods[g]),a.$options.methods=m(a).reduce((a,{key:b,method:c})=>(a[b]=c,a),a.$options.methods||{})},created:function(){const a=this;c.defineReactionList(a,l(a)),c.defineRenderReaction(a)},beforeDestroy:function(){const a=this;c.removeReactionList(a),l(a).forEach(({key:b})=>c.removeReactiveProperty(a,b))}})}},a.mapAction=a=>({[g]:a}),a.mapState=a=>({[f]:a}),Object.defineProperty(a,"__esModule",{value:!0})});